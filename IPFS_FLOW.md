# IPFS Upload Flow - Pinata (No Docker Required)

## Overview

This pipeline uses **Pinata** for IPFS uploads, which means **NO Docker or local Kubo node is required**. Everything is uploaded directly to Pinata's cloud IPFS service via their API.

## What Gets Uploaded to IPFS?

### 1. **Transaction Chart Image** (PNG)
- **File**: `/tmp/eth_tx_chart.png`
- **What it is**: A visual chart showing transaction data over time
- **Generated by**: `generate_image.py` script
- **Size**: ~40KB
- **Uploaded to**: Pinata IPFS
- **Result**: Image CID (e.g., `QmXxx...`)

### 2. **NFT Metadata** (JSON)
- **File**: `/tmp/nft_metadata.json`
- **What it is**: ERC-721 compliant metadata describing the NFT
- **Contains**:
  - Name: "Sepolia Transaction Data NFT"
  - Description: Details about the data
  - Image: `ipfs://<IMAGE_CID>` (points to the chart image)
  - Attributes: Chain, transaction count, data CID, timestamp
- **Uploaded to**: Pinata IPFS
- **Result**: Metadata CID (e.g., `QmYyy...`)

## The Complete Flow

```
1. Data Ingestion
   â””â”€> Fetch transactions from Etherscan
   â””â”€> Save as Parquet files

2. Convert to JSONL
   â””â”€> Transform Parquet to JSONL format
   â””â”€> Limit to 200 transactions

3. Generate Image
   â””â”€> Read JSONL data
   â””â”€> Create chart visualization
   â””â”€> Save as PNG: /tmp/eth_tx_chart.png

4. Upload to IPFS (Pinata)
   â”œâ”€> Upload image PNG to Pinata
   â”‚   â””â”€> Get IMAGE_CID
   â”‚
   â”œâ”€> Create metadata JSON
   â”‚   â””â”€> Reference image as ipfs://<IMAGE_CID>
   â”‚
   â””â”€> Upload metadata JSON to Pinata
       â””â”€> Get METADATA_CID

5. Deploy NFT Contract
   â””â”€> Deploy ERC-721 contract to Sepolia
   â””â”€> Get contract address

6. Mint NFT
   â””â”€> Call mint() with tokenURI = ipfs://<METADATA_CID>
   â””â”€> NFT now points to IPFS metadata
   â””â”€> Metadata points to IPFS image
```

## Why This Approach?

### âœ… **Advantages:**

1. **No Docker Required** - Uses Pinata's cloud service
2. **Persistent Storage** - Pinata keeps files pinned permanently
3. **Fast & Reliable** - Pinata's infrastructure is production-ready
4. **Global CDN** - Files accessible via Pinata's gateway worldwide
5. **ERC-721 Compliant** - Metadata follows OpenSea standards

### ðŸ“ **What's NOT Uploaded:**

- âŒ Raw Parquet files (too large, not needed on-chain)
- âŒ JSONL files (data is represented in the chart)
- âŒ Transaction details (summarized in metadata attributes)

## The NFT Structure

When someone views your NFT on OpenSea or any NFT marketplace:

```
NFT Token
  â””â”€> tokenURI: ipfs://QmMetadata...
       â””â”€> Metadata JSON
            â”œâ”€> name: "Sepolia Transaction Data NFT"
            â”œâ”€> description: "Contains 200 transactions..."
            â”œâ”€> image: ipfs://QmImage...
            â”‚    â””â”€> Chart PNG (the actual visualization)
            â””â”€> attributes:
                 â”œâ”€> Chain: Sepolia
                 â”œâ”€> Transaction Count: 200
                 â””â”€> Generated: 2025-11-16T19:00:00Z
```

## Viewing Your NFT

After minting, you can view your NFT:

1. **On Sepolia Etherscan**:
   - `https://sepolia.etherscan.io/token/<CONTRACT_ADDRESS>?a=<TOKEN_ID>`

2. **Image via Pinata Gateway**:
   - `https://gateway.pinata.cloud/ipfs/<IMAGE_CID>`

3. **Metadata via Pinata Gateway**:
   - `https://gateway.pinata.cloud/ipfs/<METADATA_CID>`

4. **On OpenSea Testnet** (may take a few minutes to index):
   - `https://testnets.opensea.io/assets/sepolia/<CONTRACT_ADDRESS>/<TOKEN_ID>`

## Configuration

Required in `.env`:

```bash
# Pinata JWT token (get from https://app.pinata.cloud/developers/api-keys)
PINATA_JWT=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Sepolia configuration
RPC_URL=https://eth-sepolia.g.alchemy.com/v2/YOUR_KEY
CHAIN_ID=11155111
PRIVATE_KEY=0x...
RECIPIENT=0x...
```

## Scripts

- **`scripts/pin_to_pinata.sh`** - Uploads image and metadata to Pinata
- **`scripts/mint.sh`** - Mints NFT with IPFS tokenURI

## Summary

**You are correct!** The pipeline:
1. âœ… Generates a chart image from transaction data
2. âœ… Uploads the image to Pinata IPFS (no Docker/Kubo)
3. âœ… Creates and uploads NFT metadata to Pinata
4. âœ… Mints an NFT with the metadata CID as tokenURI
5. âœ… The NFT permanently references the IPFS-hosted image

**No local IPFS node or Docker container is needed** - everything goes through Pinata's API! ðŸš€
